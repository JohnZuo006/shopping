<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>修改密保</title>
		<link rel="stylesheet" type="text/css" href="./css/style.css">
		<style>
		  .ff{
		       margin-left:50px;
		  }
		  #login_click{ margin-top:32px;margin-left:400px; height:40px;}
        #login_click a 
       {
    
 
    text-decoration:none;
	background:#2f435e;
	color:#f2f2f2;
	
	padding: 10px 30px 10px 30px;
	font-size:16px;
	font-family: 微软雅黑,宋体,Arial,Helvetica,Verdana,sans-serif;
	font-weight:bold;
	border-radius:3px;
	
	-webkit-transition:all linear 0.30s;
	-moz-transition:all linear 0.30s;
	transition:all linear 0.30s;
	
	}
   #login_click a:hover { background:#385f9e; }

		</style>
		<script src="js/jquery-3.5.1.min.js"></script>
		<script>
			$(function(){
				//let username = $.cookie('username')
				$.ajax({
					type:"get",
					url:"http://localhost:8080/shopping/User",
					data:{
						"type":"getInformation"
					},
					dataType:"json",
					success:function(res){
						console.log(res)
						if(res['status']==0)
						{
							console.log("0")
							console.log(res)
                            $("#user1").html("欢迎您! "+res.data.userName)
							$("#user2").html("<a href=self_info.html>个人中心</a>")
							$("#out").html("退出登录")
							//$("#user2").html(res.data.userName)
							$("#oldquestion").val(res.data.question)
						}
					},
					error:function(){
					},
					xhrFields: {
						withCredentials: true
					}
				})
				$("#out").click(function(){
					$.ajax({
						type:"get",
						url:"http://localhost:8080/shopping/User",
						data:{
							"type":"loginOut"
						},
						dataType:"json",
						success:function(res){
							console.log(res)
							if(res['status']==0)
							{
								console.log("0")
								window.location.href="login.html"
							}
						},
						error:function(res){
							
						},
						xhrFields: {
							withCredentials: true
						}
					})	
				})
				$("#check").click(function(){
					let oldques=$("#oldquestion").val()
					let oldansw=$("#oldanswer").val()
					
					$.ajax({
						type:"get",
						url:"http://localhost:8080/shopping/User",
						data:{
							"type":"checkAnswer",
							"question":oldques,
							"answer":oldansw
						},
						dataType:"json",
						success:function(res){
							console.log(res)
							if(res['status']==0)
							{
								$("#div1").html(     ' <div class="ff">请输入新问题:</div>'
										+'<div ><input type="text" id="newquestion" class="subgrzl ml40"></div>'
										+'<div class="ff">请输入新答案</div>'
										+'<div ><input type="text" id="newanswer" class="subgrzl ml40"></div>'
										+'<div id="login_click"><a id="save" href="#">保存</a></div>'
								)
								
								$("#save").click(function(){
									let ques=$("#newquestion").val()
									let answ=$("#newanswer").val()
									$.ajax({
										type:"get",
										url:"http://localhost:8080/shopping/User",
										data:{
											"type":"changeQuestion",
											"question":ques,
											"answer":answ
										},
										dataType:"json",
										success:function(res){
											console.log(res)
											if(res['status']==0)
											{
												window.location.href="changeanswer.html"
												alert("修改成功!")
											}else{
												alert("修改失败")
											}
										},
										error:function(res){
											
										},
										xhrFields: {
											withCredentials: true
										}
									})	
								})
								
								
							}else{
								alert("答案错误,请重新输入")
							}
						},
						error:function(res){
							
						},
						xhrFields: {
							withCredentials: true
						}
					})	
				})
				
				
			})
		</script>
	</head>
	<body>
	<!-- start header -->
		<header>
			<div class="top center">
				
				<div class="right fr">
					<div class="gouwuche fr"><a href="./dingdanzhongxin.html">我的订单</a></div>
					<div class="fr">
						<ul >
							<li id="user1"><a href="login.html">登录</a></li>
							<li>&nbsp;&nbsp;|</li>
							<li id="user2"><a href="self_info.html" >注册</a></li>
							<li>&nbsp;&nbsp;|</li>
							<li ><a  href="index.html">主页</a></li>
							<li>&nbsp;&nbsp;|</li>
							<li><a id="out"></a></li>
						</ul>
					</div>
					<div class="clear"></div>
				</div>
				<div class="clear"></div>
			</div>
		</header>
	<!--end header -->
	<!-- start banner_x -->
		<div class="banner_x center">
			<a href="./index.html" target="_blank"><div class="logo fl"></div></a>
			<a href=""><div class="ad_top fl"></div></a>
			<div class="nav fl">
				<ul>
					<li><a href="">小米手机</a></li>
					<li><a href="">红米</a></li>
					<li><a href="">平板·笔记本</a></li>
					<li><a href="">电视</a></li>
					<li><a href="">盒子·影音</a></li>
					<li><a href="">路由器</a></li>
					<li><a href="">智能硬件</a></li>
					<li><a href="">服务</a></li>
					<li><a href="">社区</a></li>
				</ul>
			</div>
			<div class="search fr">
				<form action="" method="post">
					<div class="text fl">
						<input type="text" class="shuru"  placeholder="小米6&nbsp;小米MIX现货">
					</div>
					<div class="submit fl">
						<input type="submit" class="sousuo" value="搜索"/>
					</div>
					<div class="clear"></div>
				</form>
				<div class="clear"></div>
			</div>
		</div>
<!-- end banner_x -->
<!-- self_info -->
	<div class="grzxbj">
		<div class="selfinfo center">
		<div class="lfnav fl">
			<div class="ddzx">订单中心</div>
			<div class="subddzx">
				<ul>
					<li><a href="./dingdanzhongxin.html" >我的订单</a></li>
					<li><a href="">待收货</a></li>
					<li><a href="">评价晒单</a></li>
					<li><a href="">退款/售后</a></li>
				</ul>
			</div>
			<div class="ddzx">个人中心</div>
			<div class="subddzx">
				<ul>
					<li><a href="./self_info.html" style="color:#ff6700;font-weight:bold;">我的个人中心</a></li>
					<li><a href="">消息通知</a></li>
					<li><a href="">优惠券</a></li>
					<li><a href="">收货地址</a></li>
				</ul>
			</div>
		</div>
		<div class="rtcont fr">
			<div class="grzlbt ml40"><span><a href="changepass.html">修改密码&nbsp;&nbsp;</a></span><span><a href="changeanswer.html">&nbsp;&nbsp;修改密保</a></span></div>
			<div id="div1">
			<div class="ff">您的密保问题是:</div>
			<div ><input type="text" id="oldquestion" class="subgrzl ml40"></div>
			<div class="ff">请输入旧答案</div>
			<div ><input type="text" id="oldanswer" class="subgrzl ml40"></div>
			<div id="login_click"><a id="check" href="#">验证</a></div>
             </div>
            
             
		</div>
		<div class="clear"></div>
		</div>
	</div>
<!-- self_info -->
		
		<footer class="mt20 center">			
			<div class="mt20">小米商城|MIUI|米聊|多看书城|小米路由器|视频电话|小米天猫店|小米淘宝直营店|小米网盟|小米移动|隐私政策|Select Region</div>
			<div>© mi.com 京ICP证110507号 京ICP备10046444号 京公网安备11010802020134号 京网文[2020]0276-042号
（京）网械平台备字（2018）第00005号 互联网药品信息服务资格证 (京)-非经营性-2014-0090 营业执照 医疗器械质量公告
增值电信业务许可证 网络食品经营备案（京）【2018】WLSPJYBAHF-12  食品经营许可证</div> 
			<div>违法和不良信息举报电话：185-0130-1238，本网站所列数据，除特殊说明，所有数据均出自我司实验室测试</div>
		</footer>
	</body>
</html>